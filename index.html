<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מרכז מידע, סיוע והטבות</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: "Calm Neutrals" - A palette grounded in warm neutrals (slate, stone) as the main background, with a supportive and clear teal for accents and calls-to-action. This creates a calm, trustworthy, and easy-to-read interface suitable for a support-oriented application. -->
    <!-- Application Structure Plan: A single-page application (SPA) with three logical, switchable views: Home, Results, and Details. The user flow is designed to be intuitive: 1) Start at 'Home' with categories and a Gemini-powered search. 2) This transitions to a 'Results' view. 3) Clicking a card transitions to a dedicated 'Details' view with an integrated Gemini feature to help draft an inquiry. This task-oriented structure (Find -> Filter -> Focus -> Act) is superior for non-technical users, as it simplifies decision-making and reduces cognitive load by removing floating modals. -->
    <!-- Visualization & Content Choices: Report Info: Directory of support services. -> Goal: Organize, Inform, Assist. -> Viz/Presentation Method: 1) Homepage: Interactive category grid, conversational search box, and a category overview chart. 2) Results: Service "cards". 3) Details View: A dedicated page with formatted text, actionable buttons, and a Gemini-powered inquiry drafter. -> Interaction: Click-to-filter, conversational search, click-for-details, click-to-generate-draft. -> Justification: This multi-layered, AI-enhanced approach guides users from a broad need to a specific, actionable step, fulfilling the core requirement of making a dense spreadsheet into an accessible and empowering tool. -> Library/Method: HTML/CSS/Tailwind for layout, Chart.js/Canvas for chart, Gemini API for intelligent features. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Rubik', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px; }
        @media (max-width: 768px) { .chart-container { height: 400px; max-height: 50vh; } }
        .loader {
            width: 24px; height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #14b8a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen flex flex-col">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-teal-700">מרכז מידע, סיוע והטבות</h1>
            <p class="text-lg md:text-xl text-slate-600 mt-2">כל המידע, ההקלות והשירותים במקום אחד, בצורה נגישה ופשוטה</p>
        </header>

        <main class="flex-grow">
            <!-- Home View -->
            <div id="home-view">
                <div class="mb-10 max-w-2xl mx-auto">
                    <label for="search-input" class="block text-center text-lg font-semibold text-slate-700 mb-3">צריכים עזרה? תארו את המצב שלכם ונמצא את השירותים המתאימים</label>
                    <div class="relative">
                        <textarea id="search-input" placeholder='לדוגמה: "אני חייל מילואים ובעל עסק, והעסק שלי נפגע כלכלית..."' rows="3" class="w-full p-4 text-base border-2 border-slate-300 rounded-2xl shadow-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition resize-none"></textarea>
                        <button id="search-button" class="absolute left-4 bottom-3 text-white bg-teal-600 hover:bg-teal-700 rounded-xl px-5 py-2 font-semibold transition flex items-center justify-center gap-2">
                            <span id="search-button-text">✨ מצאו לי שירותים</span>
                            <div id="search-loader" class="loader hidden"></div>
                        </button>
                    </div>
                </div>

                 <p class="text-center text-slate-500 mb-6">או בחרו קטגוריה</p>
                <div id="category-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 text-center">
                </div>
                
                <div class="mt-16">
                    <h2 class="text-2xl font-bold text-center text-slate-700 mb-4">התפלגות השירותים לפי קטגוריה</h2>
                     <div class="bg-white p-4 rounded-xl shadow-md">
                        <div class="chart-container">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results View -->
            <div id="results-view" class="hidden">
                <div class="flex items-center mb-6">
                    <button id="back-to-home-button" class="ml-4 px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-full font-semibold transition">→ חזרה</button>
                    <h2 id="results-title" class="text-2xl md:text-3xl font-bold text-slate-700"></h2>
                </div>
                <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
                 <div id="no-results" class="text-center py-16 hidden">
                    <p class="text-2xl text-slate-500">לא נמצאו תוצאות</p>
                    <p class="mt-2 text-slate-400">נסו לחפש מונח אחר או חזרו אחורה ובחרו קטגוריה.</p>
                </div>
            </div>

            <!-- Details View -->
            <div id="details-view" class="hidden">
                 <div class="flex items-center mb-6">
                    <button id="back-to-results-button" class="ml-4 px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded-full font-semibold transition">→ חזרה לתוצאות</button>
                </div>
                <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg max-w-4xl mx-auto">
                    <header class="pb-4 border-b border-slate-200 mb-6">
                        <h3 id="details-title" class="text-3xl sm:text-4xl font-bold text-teal-700"></h3>
                    </header>
                    <div id="details-body" class="prose max-w-none text-slate-600 leading-relaxed"></div>
                     <div class="mt-8 border-t pt-6">
                        <button id="draft-inquiry-btn" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-100 text-indigo-700 font-semibold rounded-lg hover:bg-indigo-200 transition">
                            <span id="draft-btn-text">✨ עזרו לי לנסח פנייה</span>
                            <div id="draft-loader" class="loader hidden"></div>
                        </button>
                        <div id="draft-container" class="mt-4 hidden">
                             <p class="font-semibold text-slate-700 mb-2">הנה טיוטה שאפשר להעתיק ולהשתמש בה:</p>
                             <div class="relative bg-slate-100 p-4 rounded-lg text-slate-700 border border-slate-200">
                                <pre id="draft-output" class="whitespace-pre-wrap font-sans text-sm"></pre>
                                <button id="copy-draft-btn" class="absolute top-2 left-2 px-3 py-1 text-xs bg-white border border-slate-300 rounded-md hover:bg-slate-50">העתקה</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
        
        <footer class="text-center mt-16 pt-8 border-t border-slate-200 text-slate-500 text-sm">
            <div class="font-semibold">
                <p>מאגר המידע נבנה ומתעדכן על ידי <span class="font-bold text-slate-700">מורן תסדר</span>.</p>
                 <div class="flex justify-center gap-4 my-2">
                    <a href="https://www.facebook.com/groups/morantsader/" target="_blank" class="text-teal-600 hover:text-teal-800 hover:underline">לפוסט המקורי בפייסבוק</a>
                    <a href="https://wa.me/972524244298" target="_blank" class="text-teal-600 hover:text-teal-800 hover:underline">ליצירת קשר בווטסאפ</a>
                </div>
            </div>
            <div class="mt-4">
                <p>אתר זה פותח על ידי <a href="https://www.linkedin.com/in/assafakiva" target="_blank" class="font-bold text-slate-700 hover:underline">אסף עקיבא</a>.</p>
            </div>
        </footer>
    </div>

    <script>
        const db = [
        
            {"id":1,"category":"תמיכה נפשית","org":"ערן","details":"עזרה ראשונה נפשית 24/7. אפשר לפנות באופן אנונימי ולקבל תמיכה וסיוע.","phone":"1201","link":"https://www.eran.org.il/","date":"20/06/2025"},
            {"id":2,"category":"תמיכה נפשית","org":"סהר - סיוע והקשבה ברשת","details":"סיוע נפשי אונליין לאנשים במצוקה. מתנדבים זמינים בצ'אט אישי ואנונימי.","phone":"","link":"https://sahar.org.il/","date":"20/06/2025"},
            {"id":3,"category":"בעלי עסקים","org":"קרן סיוע לעסקים","details":"מענקים והלוואות בערבות מדינה לעסקים שנפגעו מהמצב הבטחוני. תהליך הגשה מקוון.","phone":"*6150","link":"https://www.sba.org.il/","date":"21/06/2025"},
            {"id":4,"category":"ילדים ונוער","org":"עלם - עמותה לנוער במצבי סיכון","details":"מספקת מענה לבני נוער וצעירים במצבי סיכון ומצוקה, כולל קו חם, מרכזים ניידים ודיור.","phone":"03-620-3333","link":"https://www.elem.org.il/","date":"21/06/2025"},
            {"id":5,"category":"מפונים ומתפנים","org":"משרד הפנים - מרכז סיוע למפונים","details":"ריכוז כל המידע והזכויות למפונים מהצפון והדרום. כולל סיוע בשכר דירה, מענקי הסתגלות וחינוך.","phone":"*4585","link":"https://www.gov.il/he/departments/ministry_of_interior/govil-landing-page","date":"22/06/2025"},
            {"id":6,"category":"הטבות","org":"מועדון 'בהצדעה'","details":"הטבות והנחות לחיילי מילואים ובני משפחותיהם במגוון רשתות, אטרקציות ומופעים.","phone":"","link":"https://www.behatzdaa.org.il/","date":"22/06/2025"},
            {"id":7,"category":"מילואימניקים","org":"האגף והקרן לחיילים משוחררים","details":"סיוע בהשכלה, תעסוקה, וזכויות כלכליות לחיילי מילואים ששירתו מעל תקופה מסוימת.","phone":"*9144","link":"https://www.hachvana.mod.gov.il/","date":"20/06/2025"},
            {"id":8,"category":"חקלאות","org":"קנט - הקרן לביטוח נזקי טבע בחקלאות","details":"פיצויים לחקלאים על נזקים ישירים ועקיפים שנגרמו כתוצאה מהמלחמה.","phone":"*3930","link":"https://www.kanat.co.il/","date":"23/06/2025"},
            {"id":9,"category":"כללי","org":"כל זכות","details":"מאגר מידע מקיף על זכויות תושבים במגוון תחומים: בריאות, רווחה, תעסוקה ועוד.","phone":"","link":"https://www.kolzchut.org.il/he/Main_Page","date":"23/06/2025"},
            {"id":10,"category":"אישורים וטפסים","org":"רשות המיסים","details":"דחיית מועדי דיווח ותשלום למע\"מ, מקדמות ומס הכנסה לתושבי העוטף ולמגויסים.","phone":"*4954","link":"https://www.gov.il/he/departments/israel_tax_authority","date":"21/06/2025"},
            {"id":11,"category":"התנדבות","org":"לב אחד - סיוע אזרחי בחירום","details":"ריכוז יוזמות התנדבות אזרחיות לסיוע לחיילים, משפחות מפונות, חקלאים ועוד.","phone":"","link":"https://www.lev-eched.org.il/","date":"20/06/2025"},
            {"id":12,"category":"תיירות","org":"משרד התיירות","details":"מענקים ומסלולי סיוע לעסקי תיירות שנפגעו, כולל בתי מלון, צימרים ואטרקציות.","phone":"*3866","link":"https://www.gov.il/he/departments/ministry_of_tourism","date":"22/06/2025"},
            {"id":13,"category":"אנשים פרטיים","org":"המוסד לביטוח לאומי","details":"מידע על מענקים מיוחדים, דמי אבטלה, וזכויות סוציאליות לנפגעי פעולות איבה.","phone":"*6050","link":"https://www.btl.gov.il/","date":"23/06/2025"},
            {"id":14,"category":"בעלי עסקים","org":"הסוכנות לעסקים קטנים ובינוניים","details":"ייעוץ עסקי מסובסד, סדנאות והכשרות לבעלי עסקים קטנים ובינוניים.","phone":"","link":"https://www.sba.org.il/","date":"23/06/2025"}
        ];

        const categoryIcons = {
            "תמיכה נפשית": "💬", "מפונים ומתפנים": "🏠", "ילדים ונוער": "👨‍👩‍👧‍👦",
            "מילואימניקים": "🛡️", "בעלי עסקים": "💼", "הטבות": "🎁",
            "חקלאות": "🌱", "אישורים וטפסים": "📄", "התנדבות": "🤝",
            "תיירות": "✈️", "אנשים פרטיים": "👤", "כללי": "🌐"
        };
        
        const categoryColors = [
            '#4f46e5', '#db2777', '#16a34a', '#d97706', '#0891b2', '#6d28d9',
            '#ca8a04', '#78716c', '#0ea5e9', '#be185d', '#4338ca', '#166534'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchButtonText = document.getElementById('search-button-text');
            const searchLoader = document.getElementById('search-loader');
            const categoryGrid = document.getElementById('category-grid');

            const homeView = document.getElementById('home-view');
            const resultsView = document.getElementById('results-view');
            const detailsView = document.getElementById('details-view');
            
            const resultsTitle = document.getElementById('results-title');
            const resultsContainer = document.getElementById('results-container');
            const noResults = document.getElementById('no-results');
            const backToHomeButton = document.getElementById('back-to-home-button');
            const backToResultsButton = document.getElementById('back-to-results-button');
            
            const detailsTitle = document.getElementById('details-title');
            const detailsBody = document.getElementById('details-body');

            const draftInquiryBtn = document.getElementById('draft-inquiry-btn');
            const draftBtnText = document.getElementById('draft-btn-text');
            const draftLoader = document.getElementById('draft-loader');
            const draftContainer = document.getElementById('draft-container');
            const draftOutput = document.getElementById('draft-output');
            const copyDraftBtn = document.getElementById('copy-draft-btn');

            let currentItemId = null;

            const init = () => {
                renderCategories();
                renderChart();
                attachEventListeners();
            };
            
            async function callGemini(prompt, isJson = false) {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };

                if(isJson){
                    payload.generationConfig = {
                        responseMimeType: "application/json",
                    };
                }

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                         throw new Error(`API call failed with status: ${response.status}`);
                    }
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error('Invalid response structure from API');
                    }
                } catch (error) {
                    console.error("Gemini API call error:", error);
                    return null;
                }
            }


            const renderCategories = () => {
                const categories = [...new Set(db.map(item => item.category))];
                categoryGrid.innerHTML = categories.map(cat => `
                    <button data-category="${cat}" class="category-btn bg-white p-4 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all duration-300 flex flex-col items-center justify-center aspect-square">
                        <span class="text-4xl mb-2">${categoryIcons[cat] || '❓'}</span>
                        <span class="font-semibold text-center text-sm sm:text-base text-slate-700">${cat}</span>
                    </button>
                `).join('');
            };
            
            const renderChart = () => {
                const ctx = document.getElementById('categoryChart').getContext('2d');
                const categoryCounts = db.reduce((acc, item) => {
                    acc[item.category] = (acc[item.category] || 0) + 1;
                    return acc;
                }, {});
                const labels = Object.keys(categoryCounts);
                const data = Object.values(categoryCounts);
                new Chart(ctx, {
                    type: 'bar',
                    data: { labels: labels, datasets: [{ label: 'מספר שירותים', data: data, backgroundColor: categoryColors.slice(0, labels.length), borderColor: '#ffffff', borderWidth: 2, borderRadius: 5 }] },
                    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { bodyFont: { family: 'Rubik' }, titleFont: { family: 'Rubik' }}},
                        scales: { x: { beginAtZero: true, grid: { color: '#e2e8f0' }, ticks: { font: { family: 'Rubik' }, precision: 0 }},
                            y: { grid: { display: false }, ticks: { font: { family: 'Rubik', size: 14 }}}}}
                });
            };

            const renderResults = (data, title) => {
                resultsTitle.textContent = title;
                resultsContainer.innerHTML = '';
                if (data.length === 0) {
                    noResults.style.display = 'block';
                    resultsContainer.style.display = 'none';
                } else {
                    noResults.style.display = 'none';
                    resultsContainer.style.display = 'grid';
                    data.forEach(item => {
                        const card = document.createElement('div');
                        card.className = "bg-white p-6 rounded-xl shadow-md flex flex-col transition hover:shadow-lg hover:-translate-y-1";
                        card.innerHTML = `
                            <div class="flex-grow">
                                <span class="text-xs font-bold uppercase text-teal-600">${item.category}</span>
                                <h3 class="text-xl font-bold mt-1 mb-2 text-slate-800">${item.org}</h3>
                                <p class="text-slate-600 text-sm leading-relaxed">${item.details.substring(0, 100)}${item.details.length > 100 ? '...' : ''}</p>
                            </div>
                            <div class="mt-4 flex-shrink-0">
                                <button data-id="${item.id}" class="details-btn w-full px-4 py-2 bg-teal-50 text-teal-700 font-semibold rounded-lg hover:bg-teal-100 transition">לכל הפרטים</button>
                            </div>
                        `;
                        resultsContainer.appendChild(card);
                    });
                }
            };

            const renderDetailsView = (itemId) => {
                 const item = db.find(d => d.id == itemId);
                if (!item) return;
                currentItemId = itemId;

                detailsTitle.textContent = item.org;
                let bodyHtml = `<p class="mb-6 text-lg">${item.details}</p>`;
                
                if (item.link) {
                    bodyHtml += `<a href="${item.link}" target="_blank" class="no-underline inline-block w-full text-center px-6 py-3 bg-teal-600 text-white font-bold rounded-lg hover:bg-teal-700 transition mb-3">לאתר האינטרנט</a>`;
                }
                 if (item.phone) {
                    bodyHtml += `<a href="tel:${item.phone}" class="no-underline inline-block w-full text-center px-6 py-3 bg-slate-200 text-slate-800 font-bold rounded-lg hover:bg-slate-300 transition">📞 לחיוג: ${item.phone}</a>`;
                }

                detailsBody.innerHTML = bodyHtml;
                draftContainer.style.display = 'none'; // Hide draft on new item
            };
            
            const showView = (view) => {
                homeView.style.display = 'none';
                resultsView.style.display = 'none';
                detailsView.style.display = 'none';

                if (view === 'home') homeView.style.display = 'block';
                if (view === 'results') resultsView.style.display = 'block';
                if (view === 'details') detailsView.style.display = 'block';

                window.scrollTo(0, 0);
            };

            const handleGeminiSearch = async () => {
                const userInput = searchInput.value;
                if (!userInput.trim()) return;

                searchButtonText.classList.add('hidden');
                searchLoader.classList.remove('hidden');
                searchButton.disabled = true;

                const allCategories = [...new Set(db.map(item => item.category))];
                const prompt = `Based on the following user description of their situation, identify the most relevant service categories from this list: [${allCategories.join(", ")}]. Return ONLY a JSON object with a single key "categories" which is an array of the matching category strings. User description in Hebrew: "${userInput}"`;

                const result = await callGemini(prompt, true);
                
                if (result) {
                    try {
                        const parsedResult = JSON.parse(result);
                        const matchedCategories = parsedResult.categories || [];
                        if (matchedCategories.length > 0) {
                             const filteredData = db.filter(item => matchedCategories.includes(item.category));
                             renderResults(filteredData, `שירותים מומלצים עבורך`);
                        } else {
                            renderResults([], `לא מצאנו קטגוריות מתאימות`);
                        }
                    } catch(e) {
                         console.error("Failed to parse Gemini JSON response", e);
                         renderResults([], `אירעה שגיאה בעיבוד הבקשה`);
                    }
                } else {
                    renderResults([], `שירות המיפוי האוטומטי אינו זמין כעת`);
                }

                showView('results');
                searchButtonText.classList.remove('hidden');
                searchLoader.classList.add('hidden');
                searchButton.disabled = false;
            };

            const handleDraftInquiry = async () => {
                if (!currentItemId) return;
                const item = db.find(d => d.id == currentItemId);
                if (!item) return;

                draftBtnText.classList.add('hidden');
                draftLoader.classList.remove('hidden');
                draftInquiryBtn.disabled = true;

                const prompt = `A user needs help contacting an organization. Based on the organization's name and service description, draft a polite, concise, and clear inquiry template in Hebrew. The template should be ready to use, including a polite opening and closing, and should have clear placeholders in brackets like "[שם מלא]" for the user's name and "[תיאור קצר של המצב]" for their situation. The tone should be respectful and clear. Organization Name: "${item.org}". Service Description: "${item.details}".`;

                const result = await callGemini(prompt);

                if (result) {
                    draftOutput.textContent = result;
                    draftContainer.style.display = 'block';
                } else {
                    draftOutput.textContent = 'לא הצלחנו ליצור טיוטה כרגע. נסו שוב מאוחר יותר.';
                    draftContainer.style.display = 'block';
                }

                draftBtnText.classList.remove('hidden');
                draftLoader.classList.add('hidden');
                draftInquiryBtn.disabled = false;
            };

            const copyToClipboard = (text) => {
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                try {
                    document.execCommand('copy');
                    copyDraftBtn.textContent = 'הועתק!';
                    setTimeout(() => { copyDraftBtn.textContent = 'העתקה'; }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
                document.body.removeChild(ta);
            };

            const attachEventListeners = () => {
                categoryGrid.addEventListener('click', (e) => {
                    const btn = e.target.closest('.category-btn');
                    if (btn) {
                        const category = btn.dataset.category;
                        const filteredData = db.filter(item => item.category === category);
                        renderResults(filteredData, `תוצאות עבור: ${category}`);
                        showView('results');
                    }
                });

                resultsContainer.addEventListener('click', (e) => {
                    const btn = e.target.closest('.details-btn');
                    if (btn) {
                        renderDetailsView(btn.dataset.id);
                        showView('details');
                    }
                });
                
                searchButton.addEventListener('click', handleGeminiSearch);
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        handleGeminiSearch();
                    }
                });
                
                backToHomeButton.addEventListener('click', () => showView('home'));
                backToResultsButton.addEventListener('click', () => showView('results'));
                
                draftInquiryBtn.addEventListener('click', handleDraftInquiry);
                copyDraftBtn.addEventListener('click', () => {
                    if(draftOutput.textContent) copyToClipboard(draftOutput.textContent);
                });
            };

            init();
        });
    </script>
</body>
</html>
